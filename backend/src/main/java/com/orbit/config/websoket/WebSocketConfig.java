package com.orbit.config.websoket;

import org.springframework.context.annotation.Configuration;
import org.springframework.messaging.simp.config.MessageBrokerRegistry;
import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;
import org.springframework.web.socket.config.annotation.StompEndpointRegistry;
import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;

/**
 * μ›Ήμ†μΌ“ μ„¤μ •
 * - STOMP ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•μ—¬ μ‹¤μ‹κ°„ λ©”μ‹μ§•μ„ μ²λ¦¬ν•κΈ° μ„ν• μ„¤μ •
 * - μ›Ήμ†μΌ“μ„ μ‚¬μ©ν•κΈ° μ„ν• μ„¤μ • ν΄λμ¤
 * - WebSocketConfigλ” STOMP ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•μ—¬ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›κΈ° μ„ν• μ„¤μ •
 * - STOMP ν”„λ΅ν† μ½μ„ μ‚¬μ©ν•μ—¬ λ©”μ‹μ§€ λΈλ΅μ»¤λ¥Ό μ„¤μ •, λ©”μ‹μ§€ λΈλ΅μ»¤λ€ λ©”μ‹μ§€λ¥Ό μ¤‘κ³„ν•λ” μ—­ν• , ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ λ©”μ‹μ§€ κµν™μ„ λ•λ”λ‹¤.
 * - "/ws" κ²½λ΅λ΅ STOMP μ›Ήμ†μΌ“ μ—”λ“ν¬μΈνΈλ¥Ό λ“±λ΅, ν΄λΌμ΄μ–ΈνΈλ” μ΄ κ²½λ΅λ΅ μ ‘μ†ν•μ—¬ μ›Ήμ†μΌ“ μ—°κ²°μ„ μ”μ²­, μ›Ήμ†μΌ“ μ—°κ²°μ„ μ”μ²­ν•λ” μ΄μ λ”? μ›Ήμ†μΌ“μ„ μ‚¬μ©ν•μ—¬ μ‹¤μ‹κ°„μΌλ΅ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›κΈ° μ„ν•¨
 * - "/topic"μΌλ΅ μ‹μ‘ν•λ” λ©”μ‹μ§€λ¥Ό λ©”μ‹μ§€ λΈλ΅μ»¤λ΅ λΌμ°ν…, λ©”μ‹μ§€ λΈλ΅μ»¤λ” μ΄ λ©”μ‹μ§€λ¥Ό κµ¬λ…ν•κ³  μλ” ν΄λΌμ΄μ–ΈνΈμ—κ² λ©”μ‹μ§€λ¥Ό μ „λ‹¬, ν΄λΌμ΄μ–ΈνΈλ” μ΄ λ©”μ‹μ§€λ¥Ό κµ¬λ…ν•κ³  μλ‹¤κ°€ λ©”μ‹μ§€λ¥Ό λ°›μΌλ©΄ ν™”λ©΄μ— ν‘μ‹
 * - "/app"μΌλ΅ μ‹μ‘ν•λ” λ©”μ‹μ§€λ¥Ό μ»¨νΈλ΅¤λ¬λ΅ λΌμ°ν…, μ»¨νΈλ΅¤λ¬λ” μ΄ λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•μ—¬ κ²°κ³Όλ¥Ό λ°ν™, ν΄λΌμ΄μ–ΈνΈλ” μ΄ κ²°κ³Όλ¥Ό ν™”λ©΄μ— ν‘μ‹, μ΄λ• λ©”μ‹μ§€ λΈλ΅μ»¤λ” λΌμ°ν…λ§ μν–‰ν•κ³  λ©”μ‹μ§€λ¥Ό μ¤‘κ³„ν•μ§€ μ•μ, μ¤‘κ³„λ” λ©”μ‹μ§€ λΈλ΅μ»¤κ°€ μν–‰
 */
@Configuration
@EnableWebSocketMessageBroker
public class WebSocketConfig implements WebSocketMessageBrokerConfigurer {

    /**
     * π”Ή STOMP μ›Ήμ†μΌ“ μ—”λ“ν¬μΈνΈ λ“±λ΅
     * - STOMP ν”„λ΅ν† μ½ : μ›Ήμ†μΌ“μ„ μ‚¬μ©ν•κΈ° μ„ν• ν•μ„ ν”„λ΅ν† μ½λ΅ λ©”μ‹μ§€ μ „μ†΅μ„ λ‹¨μν™”ν•λ” ν”„λ΅ν† μ½, λ©”μ‹μ§€ μ „μ†΅μ„ μ„ν• ν”„λ΅ν† μ½
     * - /ws μ—”λ“ν¬μΈνΈλ΅ ν΄λΌμ΄μ–ΈνΈκ°€ WebSocket μ—°κ²°μ„ μ”μ²­ν•  μ μλ„λ΅ μ„¤μ •ν•©λ‹λ‹¤. μ΄ μ—”λ“ν¬μΈνΈμ— SockJSλ¥Ό μ‚¬μ©ν•μ—¬ μ—°κ²°μ„ μ‹λ„ν•©λ‹λ‹¤.
     * - /ws λ΅ μ ‘μ†ν•λ©΄ SockJSλ¥Ό ν†µν•΄ WebSocket μ—°κ²°μ„ μ‹λ„ν•©λ‹λ‹¤. μ¦‰ μ›Ήμ†μΌ“μ„ ν™μ„±ν™” ν•κΈ° μ„ν• μ„¤μ •
     * - μ›Ήμ†μΌ“ μ—°κ²°μ„ μ”μ²­ν•λ” μ΄μ λ”? μ›Ήμ†μΌ“μ„ μ‚¬μ©ν•μ—¬ μ‹¤μ‹κ°„μΌλ΅ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›κΈ° μ„ν•¨
     * - setAllowedOrigins("http://localhost:3000"): ν΄λΌμ΄μ–ΈνΈκ°€ Reactμ—μ„ μ‹¤ν–‰ μ¤‘μΌ λ•, localhost:3000μ—μ„μ μ”μ²­λ§
     *   ν—μ©ν•©λ‹λ‹¤. λ‹¤λ¥Έ λ„λ©”μΈμ—μ„μ μ—°κ²°μ„ μ°¨λ‹¨ν•©λ‹λ‹¤.
     * - withSockJS()λ” WebSocketμ΄ μ§€μ›λμ§€ μ•λ” ν™κ²½μ—μ„ SockJSλ¥Ό μ‚¬μ©ν•μ—¬ λ€μ²΄ λ°©μ‹μΌλ΅ μ—°κ²°μ„ μ‹λ„ν•©λ‹λ‹¤.
     * @param registry STOMP μ—”λ“ν¬μΈνΈ λ“±λ΅μ„ μ„ν• λ μ§€μ¤νΈλ¦¬
     */
    @Override
    public void registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint("/ws").setAllowedOrigins("http://localhost:3000").withSockJS();
    }

    /**
     * π”Ή λ©”μ‹μ§€ λΈλ΅μ»¤ μ„¤μ •
     * - "/topic"μΌλ΅ μ‹μ‘ν•λ” λ©”μ‹μ§€λ¥Ό λ©”μ‹μ§€ λΈλ΅μ»¤λ΅ λΌμ°ν…, μ±„ν…λ°© λ“± κ·Έλ£Ή μ±„ν…μ„ μ„ν• μ„¤μ •
     * - /queue β†’ κ°μΈ λ©”μ‹μ§€ (1:1 μ±„ν…) β†’ μ: /queue/user-100
     * - λ©”μ‹μ§€ λΈλ΅μ»¤λ” μ΄ λ©”μ‹μ§€λ¥Ό κµ¬λ…ν•κ³  μλ” ν΄λΌμ΄μ–ΈνΈμ—κ² λ©”μ‹μ§€λ¥Ό μ „λ‹¬
     * - ν΄λΌμ΄μ–ΈνΈλ” μ΄ λ©”μ‹μ§€λ¥Ό κµ¬λ…ν•κ³  μλ‹¤κ°€ λ©”μ‹μ§€λ¥Ό λ°›μΌλ©΄ ν™”λ©΄μ— ν‘μ‹
     * - "/app"μΌλ΅ μ‹μ‘ν•λ” λ©”μ‹μ§€λ¥Ό μ»¨νΈλ΅¤λ¬λ΅ λΌμ°ν…, μ»¨νΈλ΅¤λ¬μ—μ„ μ²λ¦¬
     * - μ»¨νΈλ΅¤λ¬λ” μ΄ λ©”μ‹μ§€λ¥Ό μ²λ¦¬ν•μ—¬ κ²°κ³Όλ¥Ό λ°ν™, ν΄λΌμ΄μ–ΈνΈλ” μ΄ κ²°κ³Όλ¥Ό ν™”λ©΄μ— ν‘μ‹
     * - μ΄λ• λ©”μ‹μ§€ λΈλ΅μ»¤λ” λΌμ°ν…λ§ μν–‰ν•κ³  λ©”μ‹μ§€λ¥Ό μ¤‘κ³„ν•μ§€ μ•μ, μ¤‘κ³„λ” λ©”μ‹μ§€ λΈλ΅μ»¤κ°€ μν–‰
     * - setApplicationDestinationPrefixes("/app"): ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„λ΅ λ³΄λ‚΄λ” λ©”μ‹μ§€κ°€ /appμΌλ΅ μ‹μ‘ν•λ” κ²½μ°
     *   μ»¨νΈλ΅¤λ¬μ—μ„ μ²λ¦¬λλ„λ΅ λΌμ°ν…ν•©λ‹λ‹¤.
     * @param registry λ©”μ‹μ§€ λΈλ΅μ»¤ μ„¤μ •μ„ μ„ν• λ μ§€μ¤νΈλ¦¬
     */
    @Override
    public void configureMessageBroker(MessageBrokerRegistry registry) {
        registry.enableSimpleBroker("/topic", "/queue");
        registry.setApplicationDestinationPrefixes("/app");
    }
}
